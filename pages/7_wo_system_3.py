import streamlit as st
import datetime
from my_switch import switch_page
import os

st.title("ì„¤ë¬¸ 3: ìíì¸ì˜ ê³µê²©ì ì¸ ëª¨ìŠµ")

st.markdown("""
í•´ë‹¹ ì˜ìƒì€ ìíì¸ì´ ì§‘ì—ì„œ ê°€ì¡±ê³¼ í•¨ê»˜ ìˆëŠ” ëª¨ìŠµì„ ë‹´ì€ ìœ íŠœë¸Œì…ë‹ˆë‹¤. 
ìíì¸ì´ ì–´ë¨¸ë‹ˆì—ê²Œ ì•ˆê²¨ ìˆì§€ë§Œ ìíì¸ì€ ìì‹ ì˜ ë’·í†µìˆ˜ë¡œ ì–´ë¨¸ë‹ˆë¥¼ ì—°ì†í•´ì„œ ê°€ê²©í•˜ëŠ” ëª¨ìŠµì„ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤.
ì¤‘ì¬ ë°©ì•ˆ í›„ë³´ë“¤ì€ ê°ê° strategy, purpose, immediate, standardë¼ëŠ” ìš”ì†Œë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.
ì—¬ê¸°ì„œ strategyëŠ” ì¤‘ì¬ ì „ëµì˜ ì´ë¦„ì´ë©° purposeëŠ” í•´ë‹¹ ì¤‘ì¬ ì „ëµì˜ ëª©ì ì…ë‹ˆë‹¤.
immediateëŠ” ê·¸ ìˆœê°„ì— ë‹¹ì¥ ì¡°ì¹˜ í•  ìˆ˜ ìˆëŠ” ì¤‘ì¬ ì „ëµì´ë©° standardëŠ” ì¼ë°˜ì ì¸ ìˆ˜í–‰ í•  ìˆ˜ ìˆëŠ” ì¤‘ì¬ ì „ëµì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

Survey_3ì˜ ëª©ì ì€ LLMì´ ì¤‘ì¬ ì „ëµì„ ì–¼ë§ˆë‚˜ ì ì ˆí•˜ê²Œ ì œì‹œ í•  ìˆ˜ ìˆëŠ”ì§€ ê·¸ ëŠ¥ë ¥ì„ ì¸¡ì •í•˜ëŠ” ê²ƒì— ëª©ì ì´ ìˆìŠµë‹ˆë‹¤.

ì „ì²´ ë‚´ìš©ì„ ë³´ì‹œê³ ì í•œë‹¤ë©´ ì•„ë˜ ë§í¬ë¥¼ í™•ì¸í•´ì£¼ì‹œë©´ ê°ì‚¬ë“œë¦¬ê² ìŠµë‹ˆë‹¤..
í•´ë‹¹ í´ë¦½ì˜ ì›ë³¸ ë§í¬ : https://www.youtube.com/watch?v=C-0dUcJE6hg

ê° í•­ëª©ì— ëŒ€í•˜ì—¬ 0â€¯=â€¯ì „í˜€ ë¶€ì ì ˆ, 1â€¯=â€¯ëŒ€ì²´ë¡œ ë¶€ì ì ˆ, 2â€¯=â€¯ë³´í†µ ì´í•˜, 3â€¯=â€¯ë³´í†µ ì´ìƒ, 4â€¯=â€¯ëŒ€ì²´ë¡œ ì ì ˆ, 5â€¯=â€¯ë§¤ìš° ì ì ˆ ë¡œ íŒë‹¨í•´ì£¼ì‹œë©´ ê°ì‚¬ë“œë¦¬ê² ìŠµë‹ˆë‹¤.
ì„¤ë¬¸ì´ ëë‚˜ì‹œë©´ ë°‘ì— ì œì¶œ ë²„íŠ¼ì„ ëˆ„ë¥´ì…”ì•¼ ë‹¤ìŒ í˜ì´ì§€ë¡œ ì´ë™ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
""")

# IDê°€ ì—†ìœ¼ë©´ ì‘ì„±í•˜ë¼ê³  ìœ ë„
if "expert_id" not in st.session_state or not st.session_state.expert_id:
    st.warning("ë¨¼ì € í™ˆì—ì„œ ì‘ë‹µì IDë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.")
    st.stop()

if 'survey3_submitted' not in st.session_state:
    st.session_state.survey3_submitted = False

# ë¹„ë””ì˜¤
st.video("https://youtube.com/shorts/uDWzTxF8qeY")

# í•´ê²° ë°©ì•ˆ í›„ë³´ë“¤
interventions = [
    """1. **strategy**: ê°ê° ìê·¹ ì¡°ì ˆ  \n**purpose**: ê³¼ë„í•œ ê°ê° ìê·¹ì„ ì™„í™”í•˜ì—¬ ë¶ˆì•ˆê°ì„ ì¤„ì´ê³  ì•ˆì •ëœ í–‰ë™ì„ ìœ ë„  \n**immediate**: ì¦‰ì‹œ ì¡°ìš©í•œ ê³µê°„ìœ¼ë¡œ ì´ë™í•˜ì—¬ ëª©ì†Œë¦¬ í†¤ì„ ë‚®ì¶”ê³  ë¶€ë“œëŸ½ê²Œ ëŒ€í™”í•˜ë©° ê°ê° ìê·¹ì„ ì¤„ì¸ë‹¤.  \n**standard**: êµì‹¤ ë‚´ ì¡°ìš©í•œ êµ¬ì—­ì„ ë§ˆë ¨í•˜ê³ , ì¡°ëª… ë° ì†Œë¦¬ ì¡°ì ˆ ë„êµ¬(ì†ŒìŒ ì°¨ë‹¨ í—¤ë“œí°, ê°„ì ‘ ì¡°ëª… ë“±)ë¥¼ í™œìš©í•˜ì—¬ ì¼ìƒì ì¸ ê°ê° í™˜ê²½ì„ ì¡°ì ˆí•œë‹¤.""",
    """2. **strategy**: ë¹„í­ë ¥ì  ì˜ì‚¬ì†Œí†µ ì§€ì›  \n**purpose**: ìí ì•„ë™ì´ ìì‹ ì˜ ê°ì •ì„ ë§ì´ë‚˜ ë‹¤ë¥¸ ìˆ˜ë‹¨ìœ¼ë¡œ í‘œí˜„í•  ìˆ˜ ìˆë„ë¡ ë•ê³ , ë¬¼ë¦¬ì  í–‰ë™ ëŒ€ì‹  ì ì ˆí•œ ì˜ì‚¬ì†Œí†µ ë°©ë²•ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì§€ë„  \n**immediate**: ìƒí™© ë°œìƒ ì‹œ, ë¶€ë“œëŸ½ê³  ì¹¨ì°©í•œ ì–´ì¡°ë¡œ ì•„ì´ì—ê²Œ 'ë§ë¡œ í‘œí˜„í•´ë´'ë¼ë©° ìœ ë„í•œë‹¤.  \n**standard**: ì‹œê° ìë£Œ(ì˜ˆ: ê·¸ë¦¼ ì¹´ë“œ, ì‚¬ì§„ ì¼ëŒí‘œ)ì™€ í•¨ê»˜ ì •ê¸°ì ìœ¼ë¡œ ì˜ì‚¬ì†Œí†µ êµìœ¡ì„ ì‹¤ì‹œí•˜ì—¬ ê°ì • í‘œí˜„ê³¼ ìš”êµ¬ ì „ë‹¬ ë°©ë²•ì„ ì—°ìŠµì‹œí‚¨ë‹¤""",
    """3. **strategy**: ì‹¬ë¦¬ì  ì•ˆì • ì œê³µ  \n**purpose**: ì•„ë™ì´ ì‹¬ë¦¬ì ìœ¼ë¡œ ì•ˆì •ê°ì„ íšŒë³µí•˜ê³  ê°ì •ì„ ì¡°ì ˆí•  ìˆ˜ ìˆë„ë¡ ì§€ì›  \n**immediate**: ì•„ë™ì´ ìš¸ê±°ë‚˜ ì†Œë¦¬ì¹  ë•Œ ë¶€ë“œëŸ½ê²Œ ì•ˆì•„ì£¼ê±°ë‚˜, ì°¨ë¶„í•œ ëª©ì†Œë¦¬ë¡œ 'ê´œì°®ì•„'ë¼ê³  ë§í•˜ë©° ì¦‰ê°ì  ì•ˆì •ì„ ë„ëª¨í•œë‹¤  \n**standard**: ì •ê¸°ì ì¸ íœ´ì‹ ì‹œê°„ê³¼ ì•ˆì • ì˜ì—­(ì•ˆì „ êµ¬ì—­, ì¿ ì…˜ ì½”ë„ˆ ë“±)ì„ ë§ˆë ¨í•´ ì•„ë™ì´ ììœ¨ì ìœ¼ë¡œ íœ´ì‹ì„ ì·¨í•  ìˆ˜ ìˆë„ë¡ í™˜ê²½ì„ ì¡°ì„±í•œë‹¤""",
    """4. **strategy**: ì‹œê°ì  ì§€ì› í™œìš©  \n**purpose**: ì–´ë ¤ìš´ ê°ì • ìƒí™©ì—ì„œ ì•„ë™ì—ê²Œ ëª…í™•í•œ ì‹œê° ìë£Œë¥¼ í†µí•´ ìƒí™©ì„ í•´ì„í•˜ê³  ì˜ˆì¸¡í•  ìˆ˜ ìˆë„ë¡ ë„ì›€  \n**immediate**: ë¬¸ì œê°€ ë°œìƒí•  ë•Œ ì¦‰ì‹œ ì‹œê° ìë£Œ(ì˜ˆ: ê°ì • ì¹´ë“œ, í–‰ë™ ì°¨íŠ¸)ë¥¼ ë³´ì—¬ì£¼ì–´ ì•„ë™ì´ í˜„ì¬ ìƒíƒœë¥¼ ì¸ì‹í•˜ë„ë¡ ìœ ë„í•œë‹¤.  \n**standard**: ì¼ìƒ ìˆ˜ì—…ì— ì‹œê° ì§€ì› ë„êµ¬(íƒ€ì„ íƒ€ì´ë¸”, ì¼ê³¼í‘œ ë“±)ë¥¼ í¬í•¨ì‹œì¼œ, ì•„ë™ì´ ì˜ˆì¸¡ ê°€ëŠ¥í•œ ì¼ìƒ íŒ¨í„´ì„ ì¸ì‹í•˜ê³  ì „ë°˜ì ì¸ ë¶ˆì•ˆì„ ê°ì†Œì‹œí‚¨ë‹¤""",
    """5. **strategy**: ì‚¬íšŒì  ìƒí˜¸ì‘ìš© êµìœ¡  \n**purpose**: ì•„ë™ë“¤ì´ ì„œë¡œì˜ ì‹ ì²´ì  ê²½ê³„ë¥¼ ì´í•´í•˜ê³  ì¡´ì¤‘í•  ìˆ˜ ìˆë„ë¡ ì‚¬íšŒì  ê¸°ìˆ ì„ í–¥ìƒì‹œí‚¤ê¸° ìœ„í•¨  \n**immediate**: ì¦‰ê° ìƒí™© ë°œìƒ ì‹œ, ë¶€ë“œëŸ½ê²Œ ì•„ë™ë“¤ì—ê²Œ ì„œë¡œì˜ ê±°ë¦¬ë¥¼ ìœ ì§€í•˜ë„ë¡ ì•ˆë‚´í•˜ê³  ì°¨ë¶„í•˜ê²Œ ì„¤ëª…í•œë‹¤  \n**standard**: ì •ê¸°ì ìœ¼ë¡œ ì—­í•  ë†€ì´ ë° ëª¨í˜• í™œë™ì„ í†µí•´ â€˜ì ì ˆí•œ ì‹ ì²´ ì ‘ì´‰â€™ì— ëŒ€í•œ ì‹œê° ìë£Œì™€ í•¨ê»˜ êµìœ¡ì„ ì‹¤ì‹œí•œë‹¤.""",
    """6. **strategy**: êµ¬ì¡°í™”ëœ í™˜ê²½ ì„¤ì •  \n**purpose**: ì‹ ì²´ ì ‘ì´‰ìœ¼ë¡œ ì¸í•œ ì˜¤í•´ë¥¼ ë°©ì§€í•˜ê³ , ì•„ë™ë“¤ì´ ì•ˆì „í•˜ê²Œ ìƒí˜¸ì‘ìš©í•  ìˆ˜ ìˆëŠ” ì²´ê³„ì ì¸ í™˜ê²½ì„ ì¡°ì„±í•˜ê¸° ìœ„í•¨  \n**immediate**: ë¬¸ì œê°€ ë°œìƒí•  ê²½ìš°, ì¦‰ì‹œ ë¬¼ë¦¬ì  ê±°ë¦¬ë¥¼ ë‘ë„ë¡ ì„±ì¸ì´ ì¤‘ì¬í•˜ë©° ì•ˆì „í•œ ê³µê°„ìœ¼ë¡œ ìœ ë„í•œë‹¤  \n**standard**: 'êµì‹¤ ë°°ì¹˜ë¥¼ ë³€ê²½í•˜ì—¬ ì•„ë™ë“¤ ê°„ ê±°ë¦¬ë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ í™•ë³´í•˜ê³ , ì†Œê·¸ë£¹ í™œë™ì„ í†µí•´ ìƒëŒ€ë°©ê³¼ì˜ ìƒí˜¸ì‘ìš© ê·œì¹™ì„ ëª…í™•íˆ í•œë‹¤."""
]

st.subheader("ğŸ’¡ ì œì•ˆëœ í•´ê²° ë°©ì•ˆë“¤ì— ëŒ€í•´ ê°ê° í‰ê°€í•´ ì£¼ì„¸ìš”.")

ratings = {}
for i, intervention in enumerate(interventions):
    st.markdown(intervention.strip())
    # 1) ì í•©ì„±
    suitability = st.slider(
        "â†’ ì œì•ˆëœ LLM ê¸°ë°˜ ì¤‘ì¬ ë°©ì•ˆì´ ì‹¤ì œ ì„ìƒÂ·í˜„ì¥ ìƒí™©ì—ì„œ ìíì¸ ì¤‘ì¬ì— ì ì ˆí•˜ë‹¤ê³  ìƒê°í•˜ì‹­ë‹ˆê¹Œ? (0~5)",
        0, 5, key=f"suitability_{i}"
    )
    # 2) íš¨ê³¼ ì˜ˆì¸¡
    effectiveness = st.slider(
        "â†’ í•´ë‹¹ ë°©ì•ˆì„ ì ìš©í–ˆì„ ë•Œ ì‹¤ì œ ê°œì… íš¨ê³¼ë¥¼ ê¸°ëŒ€í•  ìˆ˜ ìˆë‹¤ê³  ë³´ì‹­ë‹ˆê¹Œ? (0~5)",
        0, 5, key=f"effectiveness_{i}"
    )
    # 3) ì‹ ë¢°ì„±
    reliability = st.slider(
        "â†’ ì œì•ˆëœ ë‚´ìš©ì´ ì¶©ë¶„íˆ ê·¼ê±° ìˆê³  ì¼ê´€ì„± ìˆë‹¤ê³  ëŠë¼ì‹­ë‹ˆê¹Œ? (0~5)",
        0, 5, key=f"reliability_{i}"
    )

    ratings[intervention] = {
        "suitability": suitability,
        "effectiveness": effectiveness,
        "reliability": reliability
    }
    st.markdown("---")

clarity = st.slider(
    "â†’ LLMì˜ ì¶œë ¥ì´ ì´í•´í•˜ê¸° ì‰½ê³  ëª…ë£Œí•©ë‹ˆê¹Œ? (0~5)",
    0, 5, key="clarity"
)
overall_satisfaction = st.slider(
    "â†’ ì „ì²´ì ìœ¼ë¡œ ë³¸ LLM ê¸°ë°˜ ì¤‘ì¬ ë°©ì•ˆì— ì–¼ë§ˆë‚˜ ë§Œì¡±í•˜ì‹­ë‹ˆê¹Œ? (0~5)",
    0, 5, key="overall_satisfaction"
)

# ì¶”ê°€ ì˜ê²¬ (ì„ íƒì‚¬í•­)
comments = st.text_area(
    "ì „ì²´ì ì¸ ì˜ê²¬ ë˜ëŠ” í”¼ë“œë°± (ì„ íƒì‚¬í•­)"
)

# ì œì¶œ
if st.button("ì œì¶œ"):
    now = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    expert_id = st.session_state.expert_id
    user_dir = f"responses/{expert_id}"
    os.makedirs(user_dir, exist_ok=True)
    filepath = os.path.join(user_dir, "survey1.csv")

    # CSV í—¤ë” ì¶”ê°€ (ìµœì´ˆ ìƒì„± ì‹œì—ë§Œ)
    if not os.path.exists(filepath):
        with open(filepath, "w", encoding="utf-8") as f:
            f.write("timestamp,expert_id,intervention,suitability,effectiveness,reliability,usability,clarity,overall_satisfaction,comments\n")

    # ì‘ë‹µ ì €ì¥
    with open(filepath, "a", encoding="utf-8") as f:
        for intervention, scores in ratings.items():
            # ratings[intervention] == {"suitability":â€¦, "effectiveness":â€¦, "reliability":â€¦}
            f.write(
                f"{now},{expert_id},"
                f"\"{intervention}\","
                f"{scores['suitability']},{scores['effectiveness']},{scores['reliability']},"
                f"{clarity},{overall_satisfaction},"
                f"\"{comments}\"\n"
            )
    st.session_state.survey3_submitted = True
    st.success("ì‘ë‹µì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤!")

if st.session_state.survey3_submitted:
    col1, col2 = st.columns([1, 1])
    with col1:
        if st.button("â—€ ì´ì „ í˜ì´ì§€"):
            st.switch_page("pages/6_servey_system_2.py")       # pages/home.py (í™•ì¥ì ì œì™¸)
    with col2:
        if st.button("ë‹¤ìŒ í˜ì´ì§€ â–¶"):
            st.switch_page("pages/8_w_system_3.py")    # pages/survey2.py (í™•ì¥ì ì œì™¸)
    
